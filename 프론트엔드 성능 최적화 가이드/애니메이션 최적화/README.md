# 애니메이션 최적화

가끔씩 특정 웹사이트에서 애니메이션이 부드럽게 이어지지 않고 끊기듯 진행되는 현상을 발견할 수 있다.

이러한 현상을 jank라고 한다.

**애니메이션 원리**

애니메이션의 원리는 여러 장의 이미지가 빠르게 전환하면서 움직이는 것처럼 보이게 한다.

하지만 중간에 이미지가 빠져 있다면 부자연스럽게 보일 것이다.

웹에서의 애니메이션은 브라우저 렌더링과 밀접한 관련이 있다.

브라우저 렌더링 순서는 다음과 같다.

DOM + CSSOM → 렌더 트리 → 레이아웃 구성→ 페인트 → 컴포지트

이 과정을 통해 화면이 그려진다. 그러나 이후 스타일 요소가 변경될 경우, 렌더링 경로에서 거친 과정이 재실행되면서 새로운 화면을 그리게 된다.

이를 **리플로우**, 그리고 **리페인트**라고 한다.

**리플로우와 리페인트**

그렇다면 구체적으로 언제 리플로우, 리페인트가 발생할까? 다음과 같은 예시를 들 수 있다.

1. 처음 화면이 모두 그려진 후 → JS로 어떤 요소의 너비/ 높이가 변경될 경우
요소의 스타일이 변경됐으므로 CSSOM을 새로 만들게 된다.
레이아웃 단계에서 다시 모든 요소들의 크기와 위치를 계산.
이러한 과정을 리플로우라고 한다.
2. 처음 화면이 모두 그려진 후 → JS로 어떤 요소의 색상이 변경될 경우
요소의 스타일이 변경됐으므로 CSSOM을 새로 만들게 된다.
레이아웃 관련 요소는 건드리지 않았으므로 레이아웃 단계는 재계산되지 않음.
이러한 과정을 리페인트라고 한다.

하나의 단계를 건너뛰는 리페인트 과정이 브라우저 리소스를 덜 잡아먹는다.

**애니메이션에서 리플로우, 리페인트를 피하려면?**

위치를 변경할 경우, width, height를 사용하기 보다는 translate를,

크기 변경 시에는 scale, 회전 시킬 때는 rotate를 사용한다.